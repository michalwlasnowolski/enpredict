import sys
from Bio import Seq
from collections import Counter

class Kmers():


    def all_kmers(self, k=4):
        s=[""]
        for i in xrange(k):
            s2=[]
            for i in s:
                for a in "ACGT":
                    s2.append(i+a)
            s=s2
        return s


    def rc_kmers(self, kmers):
        res={}
        keys=[]
        for s in kmers:
            if Seq.reverse_complement(s) in keys:
                res[s]=Seq.reverse_complement(s)
            else:
                keys.append(s)
                res[s]=s
        return keys,res


    def count_vec(self, s, dic, keys, seq_len):

         d=Counter([dic[s[i:i+4]] for i in range(len(s)-3)])

         return [float(d[k])/seq_len for k in keys]


    '''def complement(self, x):
        if x == 'A': return 'T'
        elif x == 'C': return 'G'
        elif x == 'G': return 'C'
        elif x == 'T': return 'A'
        else:
            return x

    def is_compl(self, x, y):
        if len(x) != len(y):
            return False
        for i in xrange(len(x)):
            if self.complement(x[i]) != y[-i-1]:
                return False
        return True

    def get_compl(self, x):
        y = ''
        for a in x:
            y = self.complement(a) + y
        return y


    def gen_all(self, k):
        d = ['']
        alph = ['A', 'C', 'G', 'T']
        for i in xrange(k):
            new_d = []
            for s in d:
                for a in alph:
                    new_d.append(s+a)
            d = new_d
        final = []
        for seq in d:
            to_add=True
            for seq2 in final:
                if self.is_compl(seq, seq2):
                    to_add = False
                    break
            if to_add:
                final.append(seq)
        return final'''


    '''def count_kmers2(self, input_seq, k, frame_len, step):

        pass'''

    '''def count_kmers(self, input_seq, k, frame_len, step):

        keys = self.gen_all(k)

        output=''
        enhancers_seq=input_seq.split('\n')
        
        enhancers_file=enhancers_seq[:-1]


        enh_lenght=len(enhancers_file)
        for i in xrange(enh_lenght):
            id_seq=''
            sequence=''


            sequence=enhancers_file[i]
            sequence_len=len(sequence)
            kmers = dict.fromkeys(keys, 0)

            for i in xrange(0, sequence_len - k):


                s = str(sequence[i:(i+k)].upper())
                if kmers.has_key(s):
                    kmers[s]+=1
                elif kmers.has_key(self.get_compl(s)):
                    kmers[self.get_compl(s)] += 1
                else:
                    print id_seq, s
            if sequence_len == 0:
                print "no sequence for ", id_seq
            else:
                for key in keys:
                    
                    output+=("%f\t" % (float(kmers[key])/sequence_len))
            output+='\n'

        return output'''





